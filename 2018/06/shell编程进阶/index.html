<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="选择执行语句if语句     单分支         if 判断条件；then            条件为真的分支         fi     双分支         if 判断条件；then             条件为真的分支1         else             条件为假的分支2         fi     多分支         if 判断条件1；then">
<meta property="og:type" content="article">
<meta property="og:title" content="shell编程进阶">
<meta property="og:url" content="http://yoursite.com/2018/06/shell编程进阶/index.html">
<meta property="og:site_name" content="濡沫流年">
<meta property="og:description" content="选择执行语句if语句     单分支         if 判断条件；then            条件为真的分支         fi     双分支         if 判断条件；then             条件为真的分支1         else             条件为假的分支2         fi     多分支         if 判断条件1；then">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-03-09T11:51:48.366Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shell编程进阶">
<meta name="twitter:description" content="选择执行语句if语句     单分支         if 判断条件；then            条件为真的分支         fi     双分支         if 判断条件；then             条件为真的分支1         else             条件为假的分支2         fi     多分支         if 判断条件1；then">



  <link rel="alternate" href="/atom.xml" title="濡沫流年" type="application/atom+xml">




  <link rel="canonical" href="http://yoursite.com/2018/06/shell编程进阶/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>shell编程进阶 | 濡沫流年</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="bg_content">
  <canvas id="canvas"></canvas>
</div>

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">濡沫流年</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-music">

    
    
    
      
    

    

    <a href="/music" rel="section"><i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>music</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/06/shell编程进阶/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="sam yang">
      <meta itemprop="description" content="点滴青春">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="濡沫流年">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">shell编程进阶

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              

              
                
              

              <time title="创建时间：2018-06-10 14:56:13" itemprop="dateCreated datePublished" datetime="2018-06-10T14:56:13+08:00">2018-06-10</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          



          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">7.6k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">7 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="选择执行语句"><a href="#选择执行语句" class="headerlink" title="选择执行语句"></a>选择执行语句</h3><pre><code>if语句
    单分支
        if 判断条件；then
           条件为真的分支
        fi
    双分支
        if 判断条件；then
            条件为真的分支1
        else
            条件为假的分支2
        fi
    多分支
        if 判断条件1；then
            条件为真的分支
        elif 判断条件2；then
            条件为真的分支
        elif 判断条件3；then
            条件为真的分支
        else
            以上条件均不符合的分支
        fi

case语句
    case语句用于多分支的情况 根据变量匹配对应的分支来执行。
        case 变量引用 in
            par1）
            执行分支1
                ；；
            pat2）
            执行分支2
               ；；
            …………
                *）
            执行分支
        seac
case语句支持通配符写法
</code></pre><h3 id="循环执行语句"><a href="#循环执行语句" class="headerlink" title="循环执行语句"></a>循环执行语句</h3><pre><code>for语句
    for  变量名 in 列表；do 
        循环体
    done
    双小括号方法 
        即((…))格式 也可以用于算术运算 
        双小括号方法也可以使bash Shell实现C语言风格的变量操作 
            I=10    ((I++))
    列表可通过以下方式生成
    1）直接给出
        在”in”后直接列出要循环的数值
    2）数列
        通过{start..end}表示一个集合作为列表
    3）用命令生成列表
        例如”ls ~root/”命令可显示root家录下文件名。
    4）通配符生成列表
        例如”*.sh”可显示”sh”后缀文件作为循环列表
    5）还可使用变量作为列表
    例题： 编写脚本 猴子偷桃

while循环
    while CONDITION; do 
        循环体 
    done
    特殊用法（遍历文件的每一行） 
        while read line; do 
            循环体 
        done &lt; /PATH/file 
        依次读取/PATH/file文件中的每一行 且将行赋值给变量line
    进入条件：CONDITION为true 
    退出条件：CONDITION为false

until循环
    until CONDITION; do 
        循环体 
    done
    进入条件：CONDITION为true 
    退出条件：CONDITION为false
select 菜单生成
    select NAME；do
        命令
    done
    用户输入的保存在REPLY变量里
    主要用于创建菜单，按数字顺序排列的菜单项将显示在标准错误上， 并显示 PS3 提示符，等待用户输入 
    用户输入菜单列表中的某个数字，执行相应的命令
    select 是个无限循环，因此要记住用 break或用 exit 命令终止。也可以按 ctrl+c 退出循环 
    经常和 case 联合使用 与 for 循环类似，可以省略 in list，此时使用位置参量
</code></pre><h3 id="循环控制语句"><a href="#循环控制语句" class="headerlink" title="循环控制语句"></a>循环控制语句</h3><pre><code>continue [N]：
    提前结束第N层的本轮循环 而直接进入下一轮判断；最内层为 第1层
shift [n] 
    用于将参量列表 list 左移指定次数 缺省为左移一次。 
    参量列表 list 一旦被移动 最左端的那个参数就从列表中删除。while 循环遍 历位置参量列表时常用shift 
</code></pre><p>​​      ./doit.sh a b c d e f g h<br>    break [N]，结束第N层循环</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><pre><code>    f_name ( ) {
        函数体
    }
    或
    function f_name {
        函数体
    }
    或   
    funtion f_name ( ){
        函数体
    }
函数返回值
    return，提前结束本函数体
示例：取出指定网卡的IP
    ip() {
     ifconfig $1 | sed -nr &quot;s@.* inet (addr:)?([^ ]+).*@\2@p&quot;
    }
    export -f funtion_name
函数递归
</code></pre><h3 id="信号捕捉"><a href="#信号捕捉" class="headerlink" title="信号捕捉"></a>信号捕捉</h3><pre><code>trap &apos;触发指令&apos; 信号
trap &apos;-&apos; 恢复原信号
trap &apos;p&apos; 列出自定义信号列表
trap finish EXIT 脚本执行完执行finish函数
</code></pre><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><pre><code>多个变量的集合，连续的内存空间
数组中的元素有索引编号
    1. 从0开始，属于数值索引
    2. 索引可以是其它格式，属于关联索引，（注意，该功能在bash4.0后才能使用）
定义数组
    1. declare -a ARRAY
    2. declare -A ARRAY，关联数组
数组赋值
    1. 一次只给一个元素赋值
        ARRAY_NAME[INDEX]=VALUE
    示例
        students[0]=&quot;myname&quot;
    2. 给数组的所有元素赋值
    ARRAY_NAME=(&quot;VALUE1&quot; &quot;VALUE2&quot; ...)
    3. 给数组中的特定元素赋值
        ARRAY_NAME=([0]=&quot;VALUE1&quot; [1]=&quot;VALUE2&quot;)
    4. 交互式输入数组的各元素
        read -p ARRARY_NAME
显示数组的长度
    ${#ARRAY[@]}
    ${#ARRAY[*]}
显示数组的所有元素
    ${ARRAY[*]}
    ${ARRAY[@]}
示例，给数组增加新元素
    title[${#title[*]}]=&quot;VALUE&quot;
数组切片
    ${ARRAY[*]:offset:NUMBER}
        offset，要跳过的元素个数
        NUMBER，要显示的个数
</code></pre><h3 id="字符串切片"><a href="#字符串切片" class="headerlink" title="字符串切片"></a>字符串切片</h3><pre><code>${#var}：返回字符串长度
${var:offset}：返回从var中第offset以后的字符
${var:offset:number}：返回从var中第offset个字符后的字符开始，长度为number的部分
${var: -length}：取字符串最右侧几个字符
${var:offset:-length}：从最左侧跳过offset字符，一直向右取到距离最右侧lengh个字符之前的内容
 ${var: -length:-offset}：先从最右侧向左取到length个字符开始，再向右取到距离最右侧offset个字符之间的内容
</code></pre><h3 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h3><pre><code>${var#*word}，自左向右，查找第一次与word匹配，删除该字符串开头至word之间的字符
${var##*word},贪婪模式
示例
    file=“var/log/messages”  
        ${file#*/}: log/messages  
        ${file##*/}: messages
${var%word*}，自右向左，查找第一次与word匹配，删除该字符串开头至word之间的字符
${var%%word*}贪婪模式
    示例：
        url=http：//www.sss.com:80
        echo ${url%%:*} 
            结果：http
        echo ${url##*:}
            结果：80
</code></pre><h3 id="字符串查找替换"><a href="#字符串查找替换" class="headerlink" title="字符串查找替换"></a>字符串查找替换</h3><pre><code>    ${var/pattern/substr}：查找var所表示的字符串中，第一次被pattern所匹 配到的字符串，以substr替换之  
    ${var//pattern/substr}: 查找var所表示的字符串中，所有能被pattern所匹 配到的字符串，以substr替换之  
    ${var/#pattern/substr}：查找var所表示的字符串中，行首被pattern所匹 配到的字符串，以substr替换之  
    ${var/%pattern/substr}：查找var所表示的字符串中，行尾被pattern所匹 配到的字符串，以substr替换之
字符串查找并删除
    ${var/pattern}：删除var表示的字符串中第一次被pattern匹配到的字符串                       ${var//pattern}：删除var表示的字符串中所有被pattern匹配到的字符串  
    ${var/#pattern}：删除var表示的字符串中所有以pattern为行首匹配到的 字符串               ${var/%pattern}：删除var所表示的字符串中所有以pattern为行尾所匹配 到的字符串
字符大小写转换
    ${var^^}：把var中的所有小写字母转换为大写
    ${var,,}：把var中的所有大写字母转换为小写 
</code></pre><h3 id="declare"><a href="#declare" class="headerlink" title="declare"></a>declare</h3><pre><code>-r 声明或显示只读变量 
-i 将变量定义为整型数 
-a 将变量定义为数组 
-A 将变量定义为关联数组 
-f 显示已定义的所有函数名及其内容 
-F 仅显示已定义的所有函数名 
-x 声明或显示环境变量和函数 
-l  声明变量为小写字母  declare –l var=UPPER 
-u  声明变量为大写字母 declare –u var=lower
</code></pre><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><pre><code>对变量进行两次扫描
示例：
    n=10
    echo {1..$n}
        结果：{1..10}
    eval echo {1..$n}
        结果：1 2 3 4 5 6 7 8 9 10
变量间接引用
    eval tempvar=\$$variable1  
    tempvar=${!variable1}
示例：
    name=ssss
    ssss=aaaa
    eval echo \$$name
    echo ${!aaa}
        结果：aaaa
</code></pre><h3 id="mktemp-创建临时文件或目录"><a href="#mktemp-创建临时文件或目录" class="headerlink" title="mktemp  创建临时文件或目录"></a>mktemp  创建临时文件或目录</h3><pre><code>mktemp [option] fileXXX
生成随机字符文件，随机X最少个数为3个
-d: 创建临时目录  
-p DIR或--tmpdir=DIR：指明临时文件所存放目录位置   
</code></pre><h3 id="install，安装复制文件"><a href="#install，安装复制文件" class="headerlink" title="install，安装复制文件"></a>install，安装复制文件</h3><pre><code>install [option] src dest
[option]
    -m 权限
    -o 所有者
    -g 所有组
    -d 目录
示例：
    install -m 600 -osss -gaaa /etc/fstab /tmp/file
    结果：
        1. 复制/etc/fstab到/tmp/并改名为file
        2. 把该文件的权限改为600
        3. 把该文件的所有者改为sss，所属组改为aaa
</code></pre><h3 id="expect"><a href="#expect" class="headerlink" title="expect"></a>expect</h3><pre><code>主要应用于自动化交互式操作的场景，借助Expect处理交互的命令，可以将交互 过程如：ssh登录，ftp登录等写在一个脚本上，使之自动化完成。尤其适用于需 要对多台服务器执行相同操作的环境中，可以大大提高系统管理人员的工作效率
expect [option] 
    -c，从命令行执行expect
    -d，打开调试模式
相关的命令
    spawn，启动一个进程
    send，发送相应的指令
    exp_continue    匹配多个字符串在执行动作后加此命令
    expect  从进程接收字符串
    interact，停留在终端不退出
    exp_continue 匹配多个字符串在执行动作后加此命令

expect最常用的语法(tcl语言:模式-动作)
单一分支模式语法：
    expect “hi” {send “You said hi\n&quot;}
    匹配到hi后，会输出“you said hi”，并换行
多分支模式语法：
    expect &quot;hi&quot; { send &quot;You said hi\n&quot; } \
    &quot;hehe&quot; { send &quot;Hehe yourself\n&quot; } \
    &quot;bye&quot; { send &quot;Good bye\n&quot; }
匹配hi,hello,bye任意字符串时，执行相应输出。等同如下：
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">expect &#123;</span><br><span class="line"><span class="string">"hi"</span> &#123; send <span class="string">"You said hi\n"</span>&#125;</span><br><span class="line"><span class="string">"hehe"</span> &#123; send <span class="string">"Hehe yourself\n"</span>&#125;</span><br><span class="line"><span class="string">"bye"</span> &#123; send <span class="string">"Good bye\n"</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>示例:
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line">spawn scp /etc/fstab 192.168.8.100:/app</span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\n"</span>;exp_continue &#125;</span><br><span class="line"><span class="string">"password"</span> &#123; send “magedu\n<span class="string">" &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">expect eof</span></span><br></pre></td></tr></table></figure>
<p>。。。。。。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect spawn ssh 192.168.8.100</span></span><br><span class="line">    expect &#123;</span><br><span class="line">    <span class="string">"yes/no"</span> &#123; send <span class="string">"yes\n"</span>;exp_continue &#125;</span><br><span class="line">    <span class="string">"password"</span> &#123; send “magedu\n<span class="string">" &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    interact</span></span><br><span class="line"><span class="string">    #expect eof</span></span><br></pre></td></tr></table></figure></p>
<pre><code>示例:变量
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip 192.168.8.100</span><br><span class="line"><span class="built_in">set</span> user root</span><br><span class="line"><span class="built_in">set</span> password magedu</span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\n"</span>;exp_continue &#125;</span><br><span class="line"><span class="string">"password"</span> &#123; send <span class="string">"<span class="variable">$password</span>\n"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br></pre></td></tr></table></figure>
<pre><code>示例:位置参数
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> password [lindex <span class="variable">$argv</span> 2]</span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\n"</span>;exp_continue &#125;</span><br><span class="line"><span class="string">"password"</span> &#123; send <span class="string">"<span class="variable">$password</span>\n"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">interact</span><br><span class="line"><span class="comment">#./ssh3.exp 192.168.8.100 root magedu</span></span><br></pre></td></tr></table></figure>
<pre><code>示例：执行多个命令
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/expect</span></span><br><span class="line"><span class="built_in">set</span> ip [lindex <span class="variable">$argv</span> 0]</span><br><span class="line"><span class="built_in">set</span> user [lindex <span class="variable">$argv</span> 1]</span><br><span class="line"><span class="built_in">set</span> password [lindex <span class="variable">$argv</span> 2]</span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\n"</span>;exp_continue &#125; <span class="string">"password"</span> &#123; send <span class="string">"<span class="variable">$password</span>\n"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect <span class="string">"]#"</span> &#123; send <span class="string">"useradd haha\n"</span> &#125;</span><br><span class="line">expect <span class="string">"]#"</span> &#123; send <span class="string">"echo magedu |passwd --stdin haha\n"</span> &#125;</span><br><span class="line">send <span class="string">"exit\n"</span></span><br><span class="line">expect eof</span><br><span class="line"><span class="comment">#./ssh4.exp 192.168.8.100 root magedu</span></span><br></pre></td></tr></table></figure>
<pre><code>示例：shell脚本调用expect
</code></pre><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ip=<span class="variable">$1</span></span><br><span class="line">user=<span class="variable">$2</span></span><br><span class="line">password=<span class="variable">$3</span></span><br><span class="line">expect &lt;&lt;EOF</span><br><span class="line"><span class="built_in">set</span> timeout 10</span><br><span class="line">spawn ssh <span class="variable">$user</span>@<span class="variable">$ip</span></span><br><span class="line">expect &#123;</span><br><span class="line"><span class="string">"yes/no"</span> &#123; send <span class="string">"yes\n"</span>;exp_continue &#125;</span><br><span class="line"><span class="string">"password"</span> &#123; send <span class="string">"<span class="variable">$password</span>\n"</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">expect <span class="string">"]#"</span> &#123; send <span class="string">"useradd hehe\n"</span> &#125;</span><br><span class="line">expect <span class="string">"]#"</span> &#123; send <span class="string">"echo magedu |passwd --stdin hehe\n"</span> &#125;</span><br><span class="line">expect <span class="string">"]#"</span> &#123; send <span class="string">"exit\n"</span> &#125;</span><br><span class="line">expect eof</span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#./ssh5.sh 192.168.8.100 root magedu</span></span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
  
  </div>

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/06/shell编程基础/" rel="next" title="shell编程基础">
                <i class="fa fa-chevron-left"></i> shell编程基础
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/06/samba/" rel="prev" title="samba">
                samba <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="sam yang">
            
              <p class="site-author-name" itemprop="name">sam yang</p>
              <div class="site-description motion-element" itemprop="description">点滴青春</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">104</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#选择执行语句"><span class="nav-number">1.</span> <span class="nav-text">选择执行语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环执行语句"><span class="nav-number">2.</span> <span class="nav-text">循环执行语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环控制语句"><span class="nav-number">3.</span> <span class="nav-text">循环控制语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">4.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#信号捕捉"><span class="nav-number">5.</span> <span class="nav-text">信号捕捉</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数组"><span class="nav-number">6.</span> <span class="nav-text">数组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串切片"><span class="nav-number">7.</span> <span class="nav-text">字符串切片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串处理"><span class="nav-number">8.</span> <span class="nav-text">字符串处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串查找替换"><span class="nav-number">9.</span> <span class="nav-text">字符串查找替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#declare"><span class="nav-number">10.</span> <span class="nav-text">declare</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eval"><span class="nav-number">11.</span> <span class="nav-text">eval</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mktemp-创建临时文件或目录"><span class="nav-number">12.</span> <span class="nav-text">mktemp  创建临时文件或目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#install，安装复制文件"><span class="nav-number">13.</span> <span class="nav-text">install，安装复制文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#expect"><span class="nav-number">14.</span> <span class="nav-text">expect</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">sam yang</span>

  

 <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">585k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">8:52</span>
  
</div>

 
   












<div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv" style="display:none">
    本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
    <span class="post-meta-divider"></span>
</span>

  
 

</div>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
 
  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  

</div></body>
</html>
<!-- 动态背景 -->
<script type="text/javascript" src="/js/src/dynamic_bg.js"></script>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
